{% doc %}
  @prompt
    Make a sticky header with product categories on the left, logo in the middle, and icons on the right
{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-sticky-header-{{ ai_gen_id }} {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 1000;
    background-color: {{ block.settings.background_color }};
    border-bottom: {{ block.settings.border_thickness }}px solid {{ block.settings.border_color }};
    transition: all 0.3s ease;
    box-shadow: 0 2px 10px rgba(0, 0, 0, {{ block.settings.shadow_opacity | divided_by: 100.0 }});
  }

  .ai-sticky-header-container-{{ ai_gen_id }} {
    max-width: {{ settings.page_width }}px;
    margin: 0 auto;
    padding: 0 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    height: {{ block.settings.header_height }}px;
  }

  .ai-sticky-header-left-{{ ai_gen_id }} {
    display: flex;
    align-items: center;
    flex: 1;
  }

  .ai-sticky-header-categories-{{ ai_gen_id }} {
    display: flex;
    align-items: center;
    gap: {{ block.settings.category_spacing }}px;
  }

  .ai-sticky-header-category-{{ ai_gen_id }} {
    position: relative;
  }

  .ai-sticky-header-category-link-{{ ai_gen_id }} {
    color: {{ block.settings.text_color }};
    text-decoration: none;
    font-size: {{ block.settings.category_font_size }}px;
    font-weight: {{ block.settings.category_font_weight }};
    padding: 8px 12px;
    border-radius: {{ settings.buttons_radius }}px;
    transition: all 0.3s ease;
    display: block;
  }

  .ai-sticky-header-category-link-{{ ai_gen_id }}:hover {
    background-color: {{ block.settings.category_hover_bg }};
    color: {{ block.settings.category_hover_color }};
  }

  .ai-sticky-header-center-{{ ai_gen_id }} {
    flex: 0 0 auto;
    display: flex;
    justify-content: center;
  }

  .ai-sticky-header-logo-{{ ai_gen_id }} {
    display: block;
    line-height: 0;
  }

  .ai-sticky-header-logo-{{ ai_gen_id }} img {
    height: {{ block.settings.logo_height }}px;
    width: auto;
    max-width: 100%;
  }

  .ai-sticky-header-logo-placeholder-{{ ai_gen_id }} {
    height: {{ block.settings.logo_height }}px;
    width: 120px;
    background-color: #f4f4f4;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 4px;
  }

  .ai-sticky-header-logo-placeholder-{{ ai_gen_id }} svg {
    width: 80px;
    height: 40px;
    opacity: 0.5;
  }

  .ai-sticky-header-right-{{ ai_gen_id }} {
    display: flex;
    align-items: center;
    justify-content: flex-end;
    gap: {{ block.settings.icon_spacing }}px;
    flex: 1;
  }

  .ai-sticky-header-icon-{{ ai_gen_id }} {
    color: {{ block.settings.icon_color }};
    text-decoration: none;
    padding: 8px;
    border-radius: 50%;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
  }

  .ai-sticky-header-icon-{{ ai_gen_id }}:hover {
    background-color: {{ block.settings.icon_hover_bg }};
    color: {{ block.settings.icon_hover_color }};
  }

  .ai-sticky-header-icon-{{ ai_gen_id }} svg {
    width: {{ block.settings.icon_size }}px;
    height: {{ block.settings.icon_size }}px;
  }

  .ai-sticky-header-cart-count-{{ ai_gen_id }} {
    position: absolute;
    top: 2px;
    right: 2px;
    background-color: {{ block.settings.cart_badge_bg }};
    color: {{ block.settings.cart_badge_color }};
    font-size: 11px;
    font-weight: 600;
    padding: 2px 6px;
    border-radius: 10px;
    min-width: 18px;
    height: 18px;
    display: flex;
    align-items: center;
    justify-content: center;
    line-height: 1;
  }

  .ai-sticky-header-mobile-menu-{{ ai_gen_id }} {
    display: none;
  }

  @media screen and (max-width: 990px) {
    .ai-sticky-header-categories-{{ ai_gen_id }} {
      display: none;
    }

    .ai-sticky-header-mobile-menu-{{ ai_gen_id }} {
      display: flex;
    }

    .ai-sticky-header-container-{{ ai_gen_id }} {
      padding: 0 15px;
    }

    .ai-sticky-header-logo-{{ ai_gen_id }} img {
      height: {{ block.settings.logo_height | times: 0.8 }}px;
    }

    .ai-sticky-header-logo-placeholder-{{ ai_gen_id }} {
      height: {{ block.settings.logo_height | times: 0.8 }}px;
      width: 100px;
    }
  }

  @media screen and (max-width: 749px) {
    .ai-sticky-header-container-{{ ai_gen_id }} {
      height: {{ block.settings.header_height | times: 0.9 }}px;
    }

    .ai-sticky-header-right-{{ ai_gen_id }} {
      gap: {{ block.settings.icon_spacing | times: 0.7 }}px;
    }
  }
{% endstyle %}

<sticky-header-{{ ai_gen_id }}
  class="ai-sticky-header-{{ ai_gen_id }}"
  {{ block.shopify_attributes }}
>
  <div class="ai-sticky-header-container-{{ ai_gen_id }}">
    <div class="ai-sticky-header-left-{{ ai_gen_id }}">
      <button
        class="ai-sticky-header-icon-{{ ai_gen_id }} ai-sticky-header-mobile-menu-{{ ai_gen_id }}"
        aria-label="Open menu"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <line x1="3" y1="6" x2="21" y2="6"></line>
          <line x1="3" y1="12" x2="21" y2="12"></line>
          <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
      </button>

      <nav class="ai-sticky-header-categories-{{ ai_gen_id }}">
        {% for i in (1..5) %}
          {% liquid
            assign collection_key = 'category_' | append: i | append: '_collection'
            assign label_key = 'category_' | append: i | append: '_label'
            assign collection = block.settings[collection_key]
            assign label = block.settings[label_key]
          %}

          {% if collection != blank or label != blank %}
            <div class="ai-sticky-header-category-{{ ai_gen_id }}">
              <a
                href="{% if collection != blank %}{{ collection.url }}{% else %}#{% endif %}"
                class="ai-sticky-header-category-link-{{ ai_gen_id }}"
              >
                {% if label != blank %}
                  {{ label }}
                {% elsif collection != blank %}
                  {{ collection.title }}
                {% else %}
                  Category {{ i }}
                {% endif %}
              </a>
            </div>
          {% endif %}
        {% endfor %}
      </nav>
    </div>

    <div class="ai-sticky-header-center-{{ ai_gen_id }}">
      <a href="/" class="ai-sticky-header-logo-{{ ai_gen_id }}">
        {% if block.settings.logo != blank %}
          <img
            src="{{ block.settings.logo | image_url: width: 400 }}"
            alt="{{ shop.name | escape }}"
            width="{{ block.settings.logo.width }}"
            height="{{ block.settings.logo.height }}"
            loading="lazy"
          >
        {% elsif settings.logo != blank %}
          <img
            src="{{ settings.logo | image_url: width: 400 }}"
            alt="{{ shop.name | escape }}"
            width="{{ settings.logo.width }}"
            height="{{ settings.logo.height }}"
            loading="lazy"
          >
        {% else %}
          <div class="ai-sticky-header-logo-placeholder-{{ ai_gen_id }}">
            {{ 'image' | placeholder_svg_tag }}
          </div>
        {% endif %}
      </a>
    </div>

    <div class="ai-sticky-header-right-{{ ai_gen_id }}">
      {% if block.settings.show_search %}
        <a href="/search" class="ai-sticky-header-icon-{{ ai_gen_id }}" aria-label="Search">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
        </a>
      {% endif %}

      {% if block.settings.show_account %}
        <a href="/account" class="ai-sticky-header-icon-{{ ai_gen_id }}" aria-label="Account">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
            <circle cx="12" cy="7" r="4"></circle>
          </svg>
        </a>
      {% endif %}

      {% if block.settings.show_wishlist %}
        <a href="/pages/wishlist" class="ai-sticky-header-icon-{{ ai_gen_id }}" aria-label="Wishlist">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
          </svg>
        </a>
      {% endif %}

      {% if block.settings.show_cart %}
        <a href="/cart" class="ai-sticky-header-icon-{{ ai_gen_id }}" aria-label="Cart">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M9 22C9.55228 22 10 21.5523 10 21C10 20.4477 9.55228 20 9 20C8.44772 20 8 20.4477 8 21C8 21.5523 8.44772 22 9 22Z"></path>
            <path d="M20 22C20.5523 22 21 21.5523 21 21C21 20.4477 20.5523 20 20 20C19.4477 20 19 20.4477 19 21C19 21.5523 19.4477 22 20 22Z"></path>
            <path d="M1 1H5L7.68 14.39C7.77144 14.8504 8.02191 15.264 8.38755 15.5583C8.75318 15.8526 9.2107 16.009 9.68 16H19.4C19.8693 16.009 20.3268 15.8526 20.6925 15.5583C21.0581 15.264 21.3086 14.8504 21.4 14.39L23 6H6"></path>
          </svg>
          {% if cart.item_count > 0 %}
            <span class="ai-sticky-header-cart-count-{{ ai_gen_id }}">{{ cart.item_count }}</span>
          {% endif %}
        </a>
      {% endif %}
    </div>
  </div>
</sticky-header-{{ ai_gen_id }}>

<script>
  (function() {
    class StickyHeader{{ ai_gen_id }} extends HTMLElement {
      constructor() {
        super();
        this.header = this;
        this.scrollThreshold = 100;
        this.isScrolled = false;
      }

      connectedCallback() {
        this.setupScrollListener();
        this.addBodyPadding();
      }

      disconnectedCallback() {
        this.removeScrollListener();
        this.removeBodyPadding();
      }

      setupScrollListener() {
        this.handleScroll = this.handleScroll.bind(this);
        window.addEventListener('scroll', this.handleScroll, { passive: true });
        this.handleScroll();
      }

      removeScrollListener() {
        window.removeEventListener('scroll', this.handleScroll);
      }

      handleScroll() {
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        const shouldBeScrolled = scrollTop > this.scrollThreshold;

        if (shouldBeScrolled !== this.isScrolled) {
          this.isScrolled = shouldBeScrolled;

          if (this.isScrolled) {
            this.header.style.backgroundColor = '{{ block.settings.scrolled_bg_color }}';
            this.header.style.boxShadow = '0 2px 20px rgba(0, 0, 0, {{ block.settings.scrolled_shadow_opacity | divided_by: 100.0 }})';
          } else {
            this.header.style.backgroundColor = '{{ block.settings.background_color }}';
            this.header.style.boxShadow = '0 2px 10px rgba(0, 0, 0, {{ block.settings.shadow_opacity | divided_by: 100.0 }})';
          }
        }
      }

      addBodyPadding() {
        const headerHeight = this.header.offsetHeight;
        document.body.style.paddingTop = headerHeight + 'px';
      }

      removeBodyPadding() {
        document.body.style.paddingTop = '';
      }
    }

    customElements.define('sticky-header-{{ ai_gen_id }}', StickyHeader{{ ai_gen_id }});
  })();
</script>

{% schema %}
{
  "name": "Sticky header",
  "tag": null,
  "settings": [
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "range",
      "id": "header_height",
      "min": 60,
      "max": 120,
      "step": 5,
      "unit": "px",
      "label": "Header height",
      "default": 80
    },
    {
      "type": "header",
      "content": "Logo"
    },
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo image"
    },
    {
      "type": "range",
      "id": "logo_height",
      "min": 20,
      "max": 80,
      "step": 2,
      "unit": "px",
      "label": "Logo height",
      "default": 40
    },
    {
      "type": "header",
      "content": "Categories"
    },
    {
      "type": "text",
      "id": "category_1_label",
      "label": "Category 1 label"
    },
    {
      "type": "collection",
      "id": "category_1_collection",
      "label": "Category 1 collection"
    },
    {
      "type": "text",
      "id": "category_2_label",
      "label": "Category 2 label"
    },
    {
      "type": "collection",
      "id": "category_2_collection",
      "label": "Category 2 collection"
    },
    {
      "type": "text",
      "id": "category_3_label",
      "label": "Category 3 label"
    },
    {
      "type": "collection",
      "id": "category_3_collection",
      "label": "Category 3 collection"
    },
    {
      "type": "text",
      "id": "category_4_label",
      "label": "Category 4 label"
    },
    {
      "type": "collection",
      "id": "category_4_collection",
      "label": "Category 4 collection"
    },
    {
      "type": "text",
      "id": "category_5_label",
      "label": "Category 5 label"
    },
    {
      "type": "collection",
      "id": "category_5_collection",
      "label": "Category 5 collection"
    },
    {
      "type": "range",
      "id": "category_spacing",
      "min": 10,
      "max": 40,
      "step": 2,
      "unit": "px",
      "label": "Category spacing",
      "default": 20
    },
    {
      "type": "range",
      "id": "category_font_size",
      "min": 12,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Category font size",
      "default": 14
    },
    {
      "type": "select",
      "id": "category_font_weight",
      "label": "Category font weight",
      "options": [
        {
          "value": "400",
          "label": "Normal"
        },
        {
          "value": "500",
          "label": "Medium"
        },
        {
          "value": "600",
          "label": "Semi-bold"
        },
        {
          "value": "700",
          "label": "Bold"
        }
      ],
      "default": "500"
    },
    {
      "type": "header",
      "content": "Icons"
    },
    {
      "type": "checkbox",
      "id": "show_search",
      "label": "Show search icon",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_account",
      "label": "Show account icon",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_wishlist",
      "label": "Show wishlist icon",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_cart",
      "label": "Show cart icon",
      "default": true
    },
    {
      "type": "range",
      "id": "icon_size",
      "min": 16,
      "max": 32,
      "step": 2,
      "unit": "px",
      "label": "Icon size",
      "default": 20
    },
    {
      "type": "range",
      "id": "icon_spacing",
      "min": 8,
      "max": 24,
      "step": 2,
      "unit": "px",
      "label": "Icon spacing",
      "default": 12
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "scrolled_bg_color",
      "label": "Scrolled background color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text color",
      "default": "#171171"
    },
    {
      "type": "color",
      "id": "icon_color",
      "label": "Icon color",
      "default": "#171171"
    },
    {
      "type": "color",
      "id": "category_hover_bg",
      "label": "Category hover background",
      "default": "#f5f5f5"
    },
    {
      "type": "color",
      "id": "category_hover_color",
      "label": "Category hover text color",
      "default": "#171171"
    },
    {
      "type": "color",
      "id": "icon_hover_bg",
      "label": "Icon hover background",
      "default": "#f5f5f5"
    },
    {
      "type": "color",
      "id": "icon_hover_color",
      "label": "Icon hover color",
      "default": "#171171"
    },
    {
      "type": "color",
      "id": "cart_badge_bg",
      "label": "Cart badge background",
      "default": "#171171"
    },
    {
      "type": "color",
      "id": "cart_badge_color",
      "label": "Cart badge text color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "border_color",
      "label": "Border color",
      "default": "#e5e5e5"
    },
    {
      "type": "header",
      "content": "Border and shadow"
    },
    {
      "type": "range",
      "id": "border_thickness",
      "min": 0,
      "max": 5,
      "step": 1,
      "unit": "px",
      "label": "Border thickness",
      "default": 1
    },
    {
      "type": "range",
      "id": "shadow_opacity",
      "min": 0,
      "max": 50,
      "step": 5,
      "unit": "%",
      "label": "Shadow opacity",
      "default": 10
    },
    {
      "type": "range",
      "id": "scrolled_shadow_opacity",
      "min": 0,
      "max": 50,
      "step": 5,
      "unit": "%",
      "label": "Scrolled shadow opacity",
      "default": 20
    }
  ],
  "presets": [
    {
      "name": "Sticky header"
    }
  ]
}
{% endschema %}
